;(function($){$.fn.yiiGridView=function(options){return this.each(function(){var settings=$.extend({},$.fn.yiiGridView.defaults,options||{});var $this=$(this);var id=$this.attr('id');if(settings.updateSelector==undefined){settings.updateSelector='#'+id+' .'+settings.pagerClass.replace(/\s+/g,'.')+' a, #'+id+' .'+settings.tableClass.replace(/\s+/g,'.')+' thead th a';}$.fn.yiiGridView.settings[id]=settings;if(settings.ajaxUpdate.length>0){$(settings.updateSelector).live('click',function(){$.fn.yiiGridView.update(id,{url:$(this).attr('href')});return false;});}var inputSelector='#'+id+' .'+settings.filterClass+' input, '+'#'+id+' .'+settings.filterClass+' select';$('body').delegate(inputSelector,'change',function(){var data=$.param($(inputSelector));if(settings.pageVar!=undefined)data+='&'+settings.pageVar+'=1';$.fn.yiiGridView.update(id,{data:data});});$.fn.yiiGridView.selectCheckedRows(id);if(settings.selectableRows>0){$('#'+id+' .'+settings.tableClass+' > tbody > tr').live('click',function(e){if('checkbox'!=e.target.type){var $sbox=$('input.select-on-check',this);if(settings.selectableRows==1){$(this).siblings().removeClass('selected');$("input[name='"+$sbox.attr('name')+"']").attr('checked',false);}$(this).toggleClass('selected');$sbox.attr('checked',$(this).hasClass('selected'));if(settings.selectionChanged!=undefined)settings.selectionChanged(id);}});}$('#'+id+' .'+settings.tableClass+' > tbody > tr > td > input.select-on-check').live('click',function(){if(settings.selectableRows==0)return false;var $row=$(this).parent().parent();if(settings.selectableRows==1){$row.siblings().removeClass('selected');$("input:not(#"+this.id+")[name='"+this.name+"']").attr('checked',false);}if($(this).attr('checked'))$row.addClass('selected');else
$row.removeClass('selected');if(settings.selectionChanged!=undefined)settings.selectionChanged(id);return true;});if(settings.selectableRows>1){$('#'+id+' .'+settings.tableClass+' > thead > tr > th > input.select-on-check-all').live('click',function(){var checked=this.checked;var name=this.name.substring(0,this.name.length-4)+'\[\]';$("input[name='"+name+"']").each(function(){this.checked=checked;if(checked)$(this).parent().parent().addClass('selected');else
$(this).parent().parent().removeClass('selected');});});}});};$.fn.yiiGridView.defaults={ajaxUpdate:[],ajaxVar:'ajax',pagerClass:'pager',loadingClass:'loading',filterClass:'filters',tableClass:'items',selectableRows:1};$.fn.yiiGridView.settings={};$.fn.yiiGridView.getKey=function(id,row){return $('#'+id+' > div.keys > span:eq('+row+')').text();};$.fn.yiiGridView.getUrl=function(id){return $('#'+id+' > div.keys').attr('title');};$.fn.yiiGridView.getRow=function(id,row){var settings=$.fn.yiiGridView.settings[id];return $('#'+id+' .'+settings.tableClass+' > tbody > tr:eq('+row+') > td');};$.fn.yiiGridView.getColumn=function(id,column){var settings=$.fn.yiiGridView.settings[id];return $('#'+id+' .'+settings.tableClass+' > tbody > tr > td:nth-child('+(column+1)+')');};$.fn.yiiGridView.update=function(id,options){var settings=$.fn.yiiGridView.settings[id];$('#'+id).addClass(settings.loadingClass);options=$.extend({type:'GET',url:$.fn.yiiGridView.getUrl(id),success:function(data,status){$.each(settings.ajaxUpdate,function(i,v){var id='#'+v,$d=$(data),$filtered=$d.filter(id);$(id).replaceWith($filtered.size()?$filtered:$d.find(id));$.fn.yiiGridView.selectCheckedRows(v);});if(settings.afterAjaxUpdate!=undefined)settings.afterAjaxUpdate(id,data);$('#'+id).removeClass(settings.loadingClass);},error:function(XMLHttpRequest,textStatus,errorThrown){$('#'+id).removeClass(settings.loadingClass);alert(XMLHttpRequest.responseText);}},options||{});if(options.data!=undefined&&options.type=='GET'){options.url=$.param.querystring(options.url,options.data);options.data={};}if(settings.ajaxUpdate!==false){options.url=$.param.querystring(options.url,settings.ajaxVar+'='+id);if(settings.beforeAjaxUpdate!=undefined)settings.beforeAjaxUpdate(id,options);$.ajax(options);}else{if(options.type=='GET'){window.location.href=options.url;}else{var $form=$('<form action="'+options.url+'" method="post"></form>').appendTo('body');if(options.data==undefined){options.data={};}if(options.data['returnUrl']==undefined){options.data['returnUrl']=window.location.href;}$.each(options.data,function(name,value){$form.append($('<input type="hidden" name="t" value="" />').attr('name',name).val(value));});$form.submit();}}};$.fn.yiiGridView.selectCheckedRows=function(id){var settings=$.fn.yiiGridView.settings[id];$('#'+id+' .'+settings.tableClass+' > tbody > tr > td >input.select-on-check').each(function(){if($(this).attr('checked'))$(this).parent().parent().addClass('selected');});};$.fn.yiiGridView.getSelection=function(id){var settings=$.fn.yiiGridView.settings[id];var keys=$('#'+id+' > div.keys > span');var selection=[];$('#'+id+' .'+settings.tableClass+' > tbody > tr').each(function(i){if($(this).hasClass('selected'))selection.push(keys.eq(i).text());});return selection;};$.fn.yiiGridView.getChecked=function(id,column_id){var settings=$.fn.yiiGridView.settings[id];var keys=$('#'+id+' > div.keys > span');if(column_id.substring(column_id.length-2)!='\[\]')column_id=column_id+'\[\]';var checked=[];$('#'+id+' .'+settings.tableClass+' > tbody > tr > td > input[name="'+column_id+'"]').each(function(i){if($(this).attr('checked'))checked.push(keys.eq(i).text());});return checked;};})(jQuery);